<p-fieldset legend="ACTIONS" styleClass="mb-4" [toggleable]="false">
  <div class="grid grid-flow-col-dense justify-start gap-4">
    <p-button label="PAYMENT DUE" (onClick)="openPaymentDialog()"></p-button>
    <p-button label="ADD CAPITAL" (onClick)="openCapitalDialog()"></p-button>
  </div>
</p-fieldset>

<p-messages />

<p-fieldset class="col-span-3" legend="Amortization Table a.k.a Index Card">
  <p-table
    [value]="amortizationTable"
    styleClass="p-datatable-gridlines p-datatable-sm"
  >
    <ng-template pTemplate="header">
      <tr>
        <th>STATUS</th>
        <th>TRANSACTION DATE</th>
        <th>OR NO.</th>
        <th>BALANCE INTEREST</th>
        <th class="border-gray-500 border-2">INTEREST</th>
        <th class="border-gray-500 border-2">PAYMENT</th>
        <th class="border-gray-500 border-2">CAPITAL</th>
        <th class="border-gray-500 border-2">BALANCE</th>
        <th>COLLECTION</th>
        <th>CHANGE</th>
        <th>ACTIONS</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-item let-i="rowIndex">
      <tr
        [ngClass]="{
          'border-l-emerald-500 border-l-4': i === loanRepaymentData.find_upper_payment_bracket_index,
        }"
      >
        <td>
          <div class="flex items-center gap-2">
            <pre>{{ i }}</pre>
            <p-tag
              [value]="item.transaction_status.replace('_', ' ').toUpperCase()"
              [severity]="
                statusTagService.getStatusLabel(item.transaction_status)
              "
            />
            @if(item.transaction_remarks){
            <p-button
              [severity]="'secondary'"
              [text]="true"
              [rounded]="true"
              icon="pi pi-info-circle"
              [pTooltip]="item.transaction_remarks"
              tooltipPosition="bottom"
            ></p-button>
            }
          </div>
        </td>
        <td>{{ item.transaction_date | date : "MMMM dd, yyyy" }}</td>
        <td>
          {{ item?.transaction_or_number ?? "-" }}
        </td>
        <td>
          {{
            item?.balance_interest == null || item?.balance_interest === 0
              ? "-"
              : (item?.balance_interest | currency : "PHP")
          }}
        </td>
        <td class="border-gray-500 border-2">
          {{
            item.interest == null || item.interest === 0
              ? "-"
              : (item?.interest | currency : "PHP")
          }}
        </td>
        <td class="border-gray-500 border-2">
          {{
            item.payment == null || item.payment === 0
              ? "-"
              : (item?.payment | currency : "PHP")
          }}
        </td>
        <td class="border-gray-500 border-2">
          {{
            item.capital == null || item.capital === 0
              ? "-"
              : (item?.capital | currency : "PHP")
          }}
        </td>
        <td class="border-gray-500 border-2">
          {{
            item.balance == null || item.balance === 0
              ? "-"
              : (item?.balance | currency : "PHP")
          }}
        </td>
        <td>
          {{
            item.collection == null || item.collection === 0
              ? "-"
              : (item?.collection | currency : "PHP")
          }}
        </td>
        <td>
          {{
            item.change == null || item.change === 0
              ? "-"
              : (item?.change | currency : "PHP")
          }}
        </td>
        <td>
          <p-button
            [rounded]="true"
            [text]="true"
            severity="danger"
            [disabled]="i !== amortizationTable.length - 1 || i === 0"
            icon="pi pi-trash"
            pTooltip="Void Transaction (Delete)"
            tooltipPosition="top"
            tooltipStyleClass="text-center"
          />
        </td>
      </tr>
    </ng-template>
  </p-table>
</p-fieldset>
